<!DOCTYPE html>
<html lang="fr">

<%- include('./includes/head')%>


    <body>

        <%- include('./components/navbar')%>

            <div id="page-container">
                <div id="content-wrap" class="bg-light">

                    <section>
                        <div class=" d-flex justify-content-center">
                            <div class="col-8 p-4 flex-column bg-white">
                                <h1 class="display-4">Faire une demande</h1>
                                <hr>
                                <div class="row">
                                    <div class="col-6">
                                        <h3 class="display-6">Recruteur</h3>
                                        <form action="/users/demandes/recruteur" method="POST">

                                            <p>Sélectionnez l'organisation pour laquelle vous souhaitez devenir
                                                recruteur. <br> <br> Les demandes sont soumises à la validation des
                                                recuteurs de l'organisation.</p>

                                            <div class="form-group">
                                                <select class="form-control" title="Choisir une organisation ..."
                                                    name="choix">
                                                    <% organisation.forEach((orga)=> { %>
                                                        <option value="<%= orga.siren %>">
                                                            <%= orga.nom %>
                                                        </option>
                                                        <% }); %>

                                                </select>
                                            </div>


                                            <button class="btn btn-primary mt-3" type="submit">Envoyer
                                                demande</button>
                                        </form>
                                    </div>
                                    <div class="col-6">
                                        <h3 class="display-6">Administrateur</h3>

                                        <p>Les demandes d'administration sont soumises à la validation des
                                            administrateurs.</p>
                                        <form method="POST" action="/users/demandes/admin">
                                            <% if (autorisation) { %>

                                            <button class="btn btn-primary mt-3" type="submit"> Envoyer
                                                demande</button>
                                            <%} else{ %>
                                                <small class="text-danger"> Vous avez déjà saisi une demande en cours de traitement ou acceptée.</small> <br>
                                                <button class="btn btn-primary mt-3" type="submit" disabled> Envoyer
                                                    demande</button>
                                            <%} %>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    <section>
                        <div class=" d-flex justify-content-center">
                            <div class="col-8 p-4 flex-column bg-white">
                                <h1 class="display-4">Mes demandes</h1>
                                <hr>

                                <div>
                                    <h3 class="display-6">Recruteur</h3>
                                    <form action="/users/demandes/recruteurSupp" method="POST"  class="row">
                                    <table>
                                        <% if (Array.isArray(demandeRecrut)) { %>
                                            <% demandeRecrut.forEach((dmd)=> { %>
                                                <tr class="list-group-item d-flex justify-content-between align-items-center">
                                                    <th class="fw-normal">
                                                        <% for(var i=0; i < organisation.length; i++){
                                                            if(organisation[i].siren==dmd.organisation){ %>
                                                            <%= organisation[i].nom %>
                                                                <%} } %>
                                                    </th>

                                                    <th class="fw-normal ">
                                                        <%= dmd.date.toLocaleDateString("fr") %>
                                                    </th>
                                                    <th class="fw-normal">
                                                        <%= dmd.statut %>
                                                            <% if (dmd.statut==='En attente' ) { %>
                                                                <button class="btn btn-circle rounded-circle bg-primary"><i class="bi bi-hourglass text-light"></i></button>
                                                                <% } else if (dmd.statut==='Validé' ) { %>
                                                                    <button class="btn btn-circle rounded-circle bg-success"><i class="bi bi-check-lg text-light"></i></button>
                                                                    <% } else { %>
                                                                        <button class="btn btn-circle rounded-circle bg-danger"><i class="bi bi-x-lg text-light"></i></button>
                                                                        <% } %>
                                                    </th>

                                                    <th class="fw-normal">
                                                        Supprimer demande 
                                                        <a href="/users/demandes/recruteurSupp/<%= dmd.organisation%>" class="btn pe-0" name="supp"><i class="bi bi-x-lg"></i></a>

                                                    </th>

                                                </tr>
                                                <% }); %>
                                                    <% } %>
                                    </table>
                                </form>
                                </div>
                                <div>
                                    <h3 class="display-6 mt-2">Administrateur</h3>
                                    <form action="/users/demandes/adminSupp" method="POST" class="row">

                                    <table>
                                        <% demandeAdmin.forEach((dmdA)=> { %>
                                            <tr class="list-group-item d-flex justify-content-between align-items-center">
                                                <th class="fw-normal">
                                                    <%= dmdA.date.toLocaleDateString("fr") %>
                                                    <input type="hidden" name="dmdA_date" value="<%= dmdA.date %>">
                                                </th>
                                                <th class="fw-normal">
                                                    <%= dmdA.statut %>
                                                    <% if (dmdA.statut==='En attente' ) { %>
                                                        <button class="btn btn-circle rounded-circle bg-primary"> <i class="bi bi-hourglass text-light"></i></button>
                                                        <% } else if (dmdA.statut==='Validé' ) { %>
                                                            <button class="btn btn-circle rounded-circle bg-success"><i class="bi bi-check-lg text-light"></i></button>
                                                            <% } else { %>
                                                                <button class="btn btn-circle rounded-circle bg-danger"><i class="bi bi-x-lg text-light"></i></button>
                                                                <% } %>
                                                        

                                                </th>
                                                <th class="fw-normal">
                                                    Supprimer demande 
                                                    <button
                                                        class="btn pe-0" name="supp" data-date="<%= dmdA.date %>"><i
                                                            class="bi bi-x-lg"></i></button>

                                                </th>
                                            </tr>
                                            <% }) %>
                                    </table>
                                    </form>

                                </div>


                            </div>
                        </div>
                    </section>
                </div>

                <%- include('./components/footer')%>

            </div>


    </body>

</html>